## `UDP`（User Data Protocol，用户数据报协议）

`UDP`协议全称是用户数据报协议在网络中和`TCP`一样用于处理数据包，是一种无连接的协议，在OSI模型中，在传输层，处于IP协议上一层，`UDP`不提供数据包分组，组装和不能对数据包进行排序，当报文发送后，无法得知安全完整到达

### ``UDP``协议特点

**1. 面向无连接**

`UDP`协议是不需要和`TCP`一样在发送数据前进行三次握手建立连接，想发数据就可以开始发数据，书数据的搬运工，不对数据报文进行拆分和拼接操作

具体说来：

* 发送端，应用层将数据传递给传输层的`UDP`协议，`UDP`只会增加一个`UDP`头标识下是`UDP`协议，然后传送给网络层

* 接收端，网络层将数据传递给传输层，`UDP`去除IP报文头后就传递给应用层，不做拼接操作

**2. 有单播，多拨，广播的功能**

`UDP`不止支持一对一传输，同样支持一对多，多对多，多对一的方式

**3. `UDP`是面向报文的**

发送方的`UDP`对应用程序浇下来的报文，再添加首部后向下交付IP层，`UDP`对应用层浇下来的报文，既不合并，也不拆分，而是保留报文的边界

**4. 不可靠性**

不可靠性体现在无连接上，通信不需要建立连接，想发就发

收到什么数据就传什么数据，不会备份数据，发送数据不关心对方是否正确收到

网络环境时好时坏，`UDP`没有拥塞控制，一直以恒定速度发送数据，即使网络不好，也不对发送速率调整，实现弊端是网络不好下导致丢包，优点是在某些实时性要求高的场景就需要使用UDP

`UDP`只会把想发的数据报文一股脑的丢给对方，并不在意数据有无安全完整到达

**5. 头部开销小，传输数据报文高效**

![image](https://image.fundebug.com/2019-03-21-03.png)

`UDP` 头部包含了以下几个数据：

* 两个十六位的端口号，分别为源端口（可选字段）和目标端口
* 整个数据报文的长度
* 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误

因此`UDP`的头部开销小，只有八字节，相比`TCP`的至少二十字节要少得多，在传输数据报文时是很高效的


## `TCP`协议

`TCP`协议全称是传输控制协议是一种面向连接的、可靠的、基于字节流的传输层通信协议，由 IETF 的RFC 793定义

`TCP` 是面向连接的、可靠的流协议

流就是指不间断的数据结构，你可以把它想象成排水管中的水流

### `TCP`连接过程(三次握手)

![image](https://image.fundebug.com/2019-03-21-04.png)

**第一次握手**

客户端向服务端发送连接请求报文段，该报文段中包含自身的数据通讯初始序号，请求发送后，客户端便进入 SYN-SENT 状态。

**第二次握手**

服务端收到连接请求报文段后，如果同意连接，则会发送一个应答，该应答中也会包含自身的数据通讯初始序号，发送完成后便进入 SYN-RECEIVED 状态。

**第三次握手**

当客户端收到连接同意的应答后，还要向服务端发送一个确认报文，客户端发完这个报文段后便进入 ESTABLISHED 状态，服务端收到这个应答后也进入 ESTABLISHED 状态，此时连接建立成功。

### `TCP`断开连接过程(四次挥手)

![image](https://image.fundebug.com/2019-03-21-06.png)

TCP 是全双工的，在断开连接时两端都需要发送 FIN 和 ACK。

**第一次握手**

若客户端 A 认为数据发送完成，则它需要向服务端 B 发送连接释放请求。

**第二次握手**

B 收到连接释放请求后，会告诉应用层要释放 TCP 链接。然后会发送 ACK 包，并进入 CLOSE_WAIT 状态，此时表明 A 到 B 的连接已经释放，不再接收 A 发的数据了。但是因为 TCP 连接是双向的，所以 B 仍旧可以发送数据给 A。

**第三次握手**

B 如果此时还有没发完的数据会继续发送，完毕后会向 A 发送连接释放请求，然后 B 便进入 LAST-ACK 状态。

**第四次握手**

A 收到释放请求后，向 B 发送确认应答，此时 A 进入 TIME-WAIT 状态。该状态会持续 2MSL（最大段生存期，指报文段在网络中生存的时间，超时会被抛弃） 时间，若该时间段内没有 B 的重发请求的话，就进入 CLOSED 状态。当 B 收到确认应答后，也便进入 CLOSED 状态。

### `TCP`协议特点

**1. 面向连接**

面向连接，是指发送数据之前必须在两端建立连接。建立连接的方法是“三次握手”，这样能建立可靠的连接。建立连接，是为数据的可靠传输打下了基础。

**2. 仅支持单播传输**

每条TCP传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播传输方式。

**3. 面向字节流**

TCP不像UDP一样那样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输。

**4. 可靠传输**

对于可靠传输，判断丢包，误码靠的是TCP的段编号以及确认号。TCP为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。

**5. 提供拥塞控制**

当网络出现拥塞的时候，TCP能够减小向网络注入数据的速率和数量，缓解拥塞

**6. TCP提供全双工通信**

TCP允许通信双方的应用程序在任何时候都能发送数据，因为TCP连接的两端都设有缓存，用来临时存放双向通信的数据。当然，TCP可以立即发送一个数据段，也可以缓存一段时间以便一次发送更多的数据段（最大的数据段大小取决于MSS）

## `TCP`和`UDP`对比

| |	`UDP`	|`TCP`
|---|---|---|
是否连接 | 无连接 | 面向连接
是否可靠 | 不可靠传输，不使用流量控制和拥塞控制 | 可靠传输，使用流量控制和拥塞控制
连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信
传输方式 | 面向报文 | 面向字节流
首部开销	| 首部开销小，仅8字节 | 首部最小20字节，最大60字节
适用场景	| 适用于实时应用（IP电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输
